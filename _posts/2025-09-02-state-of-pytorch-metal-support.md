---
layout: post
title:  "State of PyTorch Metal support"
date:   2025-09-02 15:00:00
permalink: pytorch-metal-support
categories: metal pytorch llms nanogpt jit osx mlx
---

## TL;DR

- PyTorch supports Metal pretty well these days.
- Previously, I've experienced issues with [TorchInductor](https://dev-discuss.pytorch.org/t/torchinductor-a-pytorch-native-compiler-with-define-by-run-ir-and-symbolic-shapes/747)'s Metal backend when using `torch.compile` (as have [others](https://github.com/pytorch/pytorch/issues/152155)).
- Using the nightly pytorch build, I am no longer getting errors when training e.g. nanoGPT on Metal with compilation enabled.
- However, on my machine (a MacBook Pro M3 Max with 64 GB RAM, running Sequoia 15.6.1) training on Metal is significantly slower with compilation compared to without, which is surprising.
- [asitop](https://github.com/tlkh/asitop) is an [htop](https://htop.dev/)-like utility for the Mac which lets you monitor GPU and ANE usage.

## Background

- Apple Silicon's "unified memory" architecture makes the Mac a [potentially attractive platform](https://arxiv.org/pdf/2501.14925) for independent ML researchers, particularly when it comes to models too large to fit into VRAM for consumer NVIDIA cards.
- To take advantage of this you need an ML framework with good Metal (MPS) support, which was [first added to PyTorch](https://pytorch.org/blog/introducing-accelerated-pytorch-training-on-mac/) back in 2022. While good progress has been made since then, MPS Ops coverage is [still incomplete](https://qqaatw.dev/pytorch-mps-ops-coverage/). As of now, [over 70 ops](https://github.com/users/kulinseth/projects/1/views/1) are tagged with either "To triage" or "To be implemented". There is [a Github issue](https://github.com/pytorch/pytorch/issues/77764) you can comment on to help with prioritization.
- Apple has since released their own ML framework, called [MLX](https://github.com/ml-explore/mlx), which supports not only MPS but also Apple's Neural Engine (ANE). However, there are no tools for automatically converting PyTorch models to MLX and doing so manually is [non-trivial](https://github.com/pranavjad/mlx-gpt2). Moreover, when I tried to get [Gemini CLI](https://github.com/google-gemini/gemini-cli) to help, it kept getting stuck even after reading the relevant documentation. This might have been due to how I was prompting it, though.
- [JAX](https://github.com/jax-ml/jax) has historically prioritized TPUs when it comes to non-NVIDIA accelerators, which makes sense given its lineage. Support for MPS in JAX is [still experimental](https://github.com/jax-ml/jax?tab=readme-ov-file#supported-platforms) at this point, but [improving](https://developer.apple.com/metal/jax/).
- There is also [tinygrad](https://github.com/tinygrad/tinygrad), a cross-platform ML framework which aims to provide first-class support for MPS out of the box. Tinygrad is pretty niche, however, and its main benefit is simplicity rather than performance.
- Given its relative dominance, it would be good to get a sense of how well PyTorch supports training on Metal these days.

## nanoGPT as a yardstick

- [nanoGPT](https://github.com/karpathy/nanoGPT) is Adrej Karpathy's from-scratch implementation of GPT-2 in PyTorch.
- There are two main drivers, [`train.py`](https://github.com/karpathy/nanoGPT/blob/master/train.py) for training and [`sample.py`](https://github.com/karpathy/nanoGPT/blob/master/sample.py) for inference. 
- The default is to use NVIDIA GPUs and JIT-compile the model into optimized kernels via [`torch.compile`](https://docs.pytorch.org/tutorials/intermediate/torch_compile_tutorial.html), but you can override this using the `--device` and `--compile` command-line switches, respectively.
- When nanoGPT was first released (in 2022), MPS support in PyTorch was still nascent. Training on the Mac was limited to the CPU in practice, so much so that the [quick start section](https://github.com/karpathy/nanoGPT?tab=readme-ov-file#quick-start) of README.md branched on "I have a GPU" vs "I only have a macbook".
- This have steadily improved over time, though, as evidenced by [this github issue](https://github.com/karpathy/nanoGPT/issues/28).

## Running nanoGPT on Metal

### Setup

This assumes you have [uv](https://docs.astral.sh/uv/) installed:

- `git clone https://github.com/karpathy/nanoGPT.git`
- `cd nanoGPT`
- `uv venv`
- `uv pip install numpy transformers datasets tiktoken wandb tqdm`
- `uv pip install --pre torch --index-url https://download.pytorch.org/whl/nightly/cpu`
- `uv run data/shakespeare_char/prepare.py`

### Training (MPS, without compilation)

```
/usr/bin/time uv run train.py config/train_shakespeare_char.py --device=mps --compile=False

...

step 0: train loss 4.2874, val loss 4.2823
iter 0: loss 4.2639, time 25857.56ms, mfu -100.00%
iter 10: loss 3.1459, time 220.50ms, mfu 1.69%
iter 20: loss 2.7319, time 221.44ms, mfu 1.69%
iter 30: loss 2.6226, time 221.30ms, mfu 1.69%
iter 40: loss 2.5756, time 220.74ms, mfu 1.69%
iter 50: loss 2.5239, time 220.24ms, mfu 1.69%
iter 60: loss 2.5127, time 220.67ms, mfu 1.69%
iter 70: loss 2.4897, time 222.41ms, mfu 1.69%
iter 80: loss 2.4936, time 220.38ms, mfu 1.69%
iter 90: loss 2.4706, time 220.58ms, mfu 1.69%
iter 100: loss 2.4636, time 221.86ms, mfu 1.69%
iter 110: loss 2.4584, time 220.44ms, mfu 1.69%
iter 120: loss 2.4334, time 221.51ms, mfu 1.69%
iter 130: loss 2.4130, time 221.37ms, mfu 1.69%
iter 140: loss 2.4097, time 221.58ms, mfu 1.69%
iter 150: loss 2.4161, time 220.16ms, mfu 1.69%
iter 160: loss 2.3752, time 219.79ms, mfu 1.69%
iter 170: loss 2.3496, time 219.83ms, mfu 1.69%
iter 180: loss 2.3133, time 218.38ms, mfu 1.69%
iter 190: loss 2.2534, time 220.72ms, mfu 1.69%
iter 200: loss 2.2061, time 223.19ms, mfu 1.69%
iter 210: loss 2.1465, time 220.89ms, mfu 1.69%
iter 220: loss 2.1415, time 221.87ms, mfu 1.69%
iter 230: loss 2.0738, time 222.44ms, mfu 1.69%
iter 240: loss 2.0791, time 223.38ms, mfu 1.68%
step 250: train loss 1.9639, val loss 2.0676
saving checkpoint to out-shakespeare-char
iter 250: loss 2.0307, time 26177.52ms, mfu 1.52%
iter 260: loss 1.9755, time 219.98ms, mfu 1.53%
iter 270: loss 1.9861, time 221.61ms, mfu 1.55%
iter 280: loss 1.9836, time 220.16ms, mfu 1.56%
iter 290: loss 1.9136, time 220.41ms, mfu 1.58%
iter 300: loss 1.9041, time 222.54ms, mfu 1.59%
iter 310: loss 1.8694, time 220.51ms, mfu 1.60%
iter 320: loss 1.8489, time 221.12ms, mfu 1.61%
iter 330: loss 1.8202, time 221.09ms, mfu 1.61%
iter 340: loss 1.7835, time 223.61ms, mfu 1.62%
iter 350: loss 1.8329, time 223.09ms, mfu 1.62%
iter 360: loss 1.7703, time 223.91ms, mfu 1.63%
iter 370: loss 1.7435, time 223.78ms, mfu 1.63%
iter 380: loss 1.7294, time 224.15ms, mfu 1.63%
iter 390: loss 1.7318, time 225.19ms, mfu 1.64%
iter 400: loss 1.7654, time 228.42ms, mfu 1.64%
iter 410: loss 1.6971, time 225.73ms, mfu 1.64%
iter 420: loss 1.7158, time 225.99ms, mfu 1.64%
iter 430: loss 1.6959, time 226.27ms, mfu 1.64%
iter 440: loss 1.6612, time 227.08ms, mfu 1.64%
iter 450: loss 1.6626, time 227.18ms, mfu 1.64%
iter 460: loss 1.6016, time 226.84ms, mfu 1.64%
iter 470: loss 1.6591, time 227.37ms, mfu 1.64%
iter 480: loss 1.6209, time 227.93ms, mfu 1.64%
iter 490: loss 1.6045, time 228.79ms, mfu 1.64%
step 500: train loss 1.5304, val loss 1.7326
saving checkpoint to out-shakespeare-char
iter 500: loss 1.6015, time 27796.83ms, mfu 1.48%
iter 510: loss 1.6088, time 215.97ms, mfu 1.50%
iter 520: loss 1.5892, time 229.07ms, mfu 1.51%
iter 530: loss 1.5687, time 215.80ms, mfu 1.53%
iter 540: loss 1.6287, time 215.88ms, mfu 1.55%
iter 550: loss 1.5679, time 222.95ms, mfu 1.57%
iter 560: loss 1.5603, time 219.29ms, mfu 1.58%
iter 570: loss 1.5731, time 222.24ms, mfu 1.59%
iter 580: loss 1.5379, time 219.78ms, mfu 1.60%
iter 590: loss 1.4956, time 219.10ms, mfu 1.61%
iter 600: loss 1.5200, time 219.26ms, mfu 1.62%
iter 610: loss 1.5503, time 220.78ms, mfu 1.63%
iter 620: loss 1.5390, time 217.59ms, mfu 1.63%
iter 630: loss 1.5133, time 220.12ms, mfu 1.64%
iter 640: loss 1.4669, time 218.32ms, mfu 1.65%
iter 650: loss 1.5037, time 219.34ms, mfu 1.65%
iter 660: loss 1.5115, time 222.03ms, mfu 1.65%
iter 670: loss 1.4500, time 221.64ms, mfu 1.66%
iter 680: loss 1.5156, time 226.53ms, mfu 1.66%
iter 690: loss 1.4688, time 231.44ms, mfu 1.65%
iter 700: loss 1.4879, time 231.41ms, mfu 1.65%
iter 710: loss 1.4651, time 232.07ms, mfu 1.64%
iter 720: loss 1.4430, time 234.60ms, mfu 1.64%
iter 730: loss 1.4229, time 233.13ms, mfu 1.63%
iter 740: loss 1.4325, time 232.91ms, mfu 1.63%
step 750: train loss 1.3667, val loss 1.5915
saving checkpoint to out-shakespeare-char
iter 750: loss 1.4285, time 27552.22ms, mfu 1.47%
iter 760: loss 1.4502, time 222.50ms, mfu 1.49%
iter 770: loss 1.4271, time 226.36ms, mfu 1.50%
iter 780: loss 1.4165, time 226.10ms, mfu 1.52%
iter 790: loss 1.4168, time 234.46ms, mfu 1.53%
iter 800: loss 1.4364, time 224.71ms, mfu 1.54%
iter 810: loss 1.4094, time 223.45ms, mfu 1.55%
iter 820: loss 1.4114, time 223.49ms, mfu 1.56%
iter 830: loss 1.3986, time 222.64ms, mfu 1.57%
iter 840: loss 1.4064, time 224.39ms, mfu 1.58%
iter 850: loss 1.3950, time 221.68ms, mfu 1.59%
iter 860: loss 1.3920, time 221.22ms, mfu 1.60%
iter 870: loss 1.3956, time 220.42ms, mfu 1.61%
iter 880: loss 1.3742, time 221.23ms, mfu 1.62%
iter 890: loss 1.3831, time 221.20ms, mfu 1.62%
iter 900: loss 1.3674, time 221.06ms, mfu 1.63%
iter 910: loss 1.3178, time 220.36ms, mfu 1.64%
iter 920: loss 1.3665, time 219.55ms, mfu 1.64%
iter 930: loss 1.3601, time 219.51ms, mfu 1.65%
iter 940: loss 1.3424, time 218.58ms, mfu 1.65%
iter 950: loss 1.3478, time 219.06ms, mfu 1.66%
iter 960: loss 1.3619, time 220.18ms, mfu 1.66%
iter 970: loss 1.3570, time 219.52ms, mfu 1.67%
iter 980: loss 1.3600, time 220.27ms, mfu 1.67%
iter 990: loss 1.3439, time 219.64ms, mfu 1.67%
step 1000: train loss 1.2765, val loss 1.5207
saving checkpoint to out-shakespeare-char
iter 1000: loss 1.3395, time 26570.18ms, mfu 1.51%
iter 1010: loss 1.3342, time 229.69ms, mfu 1.52%
iter 1020: loss 1.3181, time 231.85ms, mfu 1.53%
iter 1030: loss 1.3407, time 232.39ms, mfu 1.53%
iter 1040: loss 1.3586, time 234.83ms, mfu 1.54%
iter 1050: loss 1.2943, time 235.35ms, mfu 1.54%
iter 1060: loss 1.3386, time 233.75ms, mfu 1.55%
iter 1070: loss 1.3295, time 235.17ms, mfu 1.55%
iter 1080: loss 1.3429, time 236.27ms, mfu 1.55%
iter 1090: loss 1.3535, time 236.37ms, mfu 1.56%
iter 1100: loss 1.3148, time 238.34ms, mfu 1.56%
iter 1110: loss 1.3013, time 240.80ms, mfu 1.56%
iter 1120: loss 1.2952, time 241.30ms, mfu 1.56%
iter 1130: loss 1.3023, time 243.52ms, mfu 1.55%
iter 1140: loss 1.3003, time 243.23ms, mfu 1.55%
iter 1150: loss 1.3065, time 245.00ms, mfu 1.55%
iter 1160: loss 1.3334, time 247.51ms, mfu 1.54%
iter 1170: loss 1.2924, time 246.93ms, mfu 1.54%
iter 1180: loss 1.3215, time 247.62ms, mfu 1.54%
iter 1190: loss 1.2711, time 250.14ms, mfu 1.53%
iter 1200: loss 1.2888, time 244.73ms, mfu 1.53%
iter 1210: loss 1.2660, time 250.02ms, mfu 1.53%
iter 1220: loss 1.3038, time 251.17ms, mfu 1.52%
iter 1230: loss 1.2980, time 242.63ms, mfu 1.52%
iter 1240: loss 1.2978, time 217.38ms, mfu 1.54%
step 1250: train loss 1.2037, val loss 1.4909
saving checkpoint to out-shakespeare-char
iter 1250: loss 1.2848, time 96683.24ms, mfu 1.39%
iter 1260: loss 1.2832, time 230.06ms, mfu 1.41%
iter 1270: loss 1.2713, time 233.71ms, mfu 1.43%
iter 1280: loss 1.2529, time 235.21ms, mfu 1.45%
iter 1290: loss 1.2943, time 237.21ms, mfu 1.46%
iter 1300: loss 1.3052, time 237.90ms, mfu 1.47%
iter 1310: loss 1.2366, time 238.37ms, mfu 1.48%
iter 1320: loss 1.2940, time 238.18ms, mfu 1.49%
iter 1330: loss 1.2608, time 237.67ms, mfu 1.50%
iter 1340: loss 1.2992, time 235.87ms, mfu 1.50%
iter 1350: loss 1.2610, time 234.88ms, mfu 1.51%
iter 1360: loss 1.2780, time 234.11ms, mfu 1.52%
iter 1370: loss 1.2593, time 233.55ms, mfu 1.53%
iter 1380: loss 1.2671, time 232.69ms, mfu 1.53%
iter 1390: loss 1.2479, time 231.85ms, mfu 1.54%
iter 1400: loss 1.2619, time 233.26ms, mfu 1.55%
iter 1410: loss 1.2502, time 233.76ms, mfu 1.55%
iter 1420: loss 1.2719, time 232.95ms, mfu 1.56%
iter 1430: loss 1.2438, time 233.29ms, mfu 1.56%
iter 1440: loss 1.2630, time 234.03ms, mfu 1.56%
iter 1450: loss 1.2328, time 235.71ms, mfu 1.57%
iter 1460: loss 1.2412, time 237.39ms, mfu 1.57%
iter 1470: loss 1.2189, time 238.14ms, mfu 1.57%
iter 1480: loss 1.2085, time 240.99ms, mfu 1.56%
iter 1490: loss 1.2383, time 244.62ms, mfu 1.56%
step 1500: train loss 1.1579, val loss 1.4892
saving checkpoint to out-shakespeare-char
iter 1500: loss 1.1827, time 31654.81ms, mfu 1.41%
iter 1510: loss 1.2336, time 289.01ms, mfu 1.39%
iter 1520: loss 1.2221, time 284.06ms, mfu 1.39%
iter 1530: loss 1.2560, time 294.47ms, mfu 1.37%
iter 1540: loss 1.1913, time 292.37ms, mfu 1.36%
iter 1550: loss 1.2314, time 299.95ms, mfu 1.35%
iter 1560: loss 1.2085, time 297.92ms, mfu 1.34%
iter 1570: loss 1.2383, time 296.49ms, mfu 1.33%
iter 1580: loss 1.2058, time 300.80ms, mfu 1.32%
iter 1590: loss 1.1934, time 307.50ms, mfu 1.31%
iter 1600: loss 1.1913, time 308.80ms, mfu 1.30%
iter 1610: loss 1.2400, time 302.97ms, mfu 1.29%
iter 1620: loss 1.1869, time 295.65ms, mfu 1.29%
iter 1630: loss 1.2049, time 223.56ms, mfu 1.33%
iter 1640: loss 1.2020, time 249.82ms, mfu 1.34%
iter 1650: loss 1.1769, time 247.00ms, mfu 1.36%
iter 1660: loss 1.2194, time 216.71ms, mfu 1.40%
iter 1670: loss 1.1942, time 221.23ms, mfu 1.43%
iter 1680: loss 1.2039, time 220.19ms, mfu 1.45%
iter 1690: loss 1.2036, time 216.05ms, mfu 1.48%
iter 1700: loss 1.1911, time 218.77ms, mfu 1.50%
iter 1710: loss 1.1831, time 222.27ms, mfu 1.52%
iter 1720: loss 1.1808, time 218.24ms, mfu 1.54%
iter 1730: loss 1.1994, time 215.94ms, mfu 1.56%
iter 1740: loss 1.1662, time 204.59ms, mfu 1.58%
step 1750: train loss 1.1029, val loss 1.4673
saving checkpoint to out-shakespeare-char
iter 1750: loss 1.1843, time 26569.58ms, mfu 1.43%
iter 1760: loss 1.1868, time 231.83ms, mfu 1.44%
iter 1770: loss 1.2018, time 233.57ms, mfu 1.46%
iter 1780: loss 1.1913, time 235.83ms, mfu 1.47%
iter 1790: loss 1.1884, time 235.63ms, mfu 1.48%
iter 1800: loss 1.1809, time 235.71ms, mfu 1.49%
iter 1810: loss 1.1681, time 235.59ms, mfu 1.50%
iter 1820: loss 1.1662, time 234.17ms, mfu 1.51%
iter 1830: loss 1.1693, time 233.44ms, mfu 1.52%
iter 1840: loss 1.1623, time 233.03ms, mfu 1.53%
iter 1850: loss 1.1605, time 233.21ms, mfu 1.53%
iter 1860: loss 1.1769, time 232.15ms, mfu 1.54%
iter 1870: loss 1.1410, time 231.46ms, mfu 1.55%
iter 1880: loss 1.1799, time 230.80ms, mfu 1.55%
iter 1890: loss 1.1785, time 231.62ms, mfu 1.56%
iter 1900: loss 1.1319, time 229.51ms, mfu 1.57%
iter 1910: loss 1.1671, time 229.41ms, mfu 1.57%
iter 1920: loss 1.1711, time 230.37ms, mfu 1.58%
iter 1930: loss 1.1486, time 230.12ms, mfu 1.58%
iter 1940: loss 1.1223, time 230.37ms, mfu 1.58%
iter 1950: loss 1.1379, time 229.87ms, mfu 1.59%
iter 1960: loss 1.1540, time 229.49ms, mfu 1.59%
iter 1970: loss 1.1496, time 229.35ms, mfu 1.60%
iter 1980: loss 1.1502, time 228.21ms, mfu 1.60%
iter 1990: loss 1.1468, time 227.74ms, mfu 1.60%
step 2000: train loss 1.0554, val loss 1.4797
iter 2000: loss 1.1304, time 28188.48ms, mfu 1.44%
iter 2010: loss 1.1317, time 248.73ms, mfu 1.45%
iter 2020: loss 1.1198, time 251.96ms, mfu 1.45%
iter 2030: loss 1.1495, time 253.84ms, mfu 1.45%
iter 2040: loss 1.1425, time 256.73ms, mfu 1.45%
iter 2050: loss 1.1165, time 257.54ms, mfu 1.45%
iter 2060: loss 1.1020, time 261.02ms, mfu 1.45%
iter 2070: loss 1.1241, time 264.20ms, mfu 1.45%
iter 2080: loss 1.1232, time 265.72ms, mfu 1.44%
iter 2090: loss 1.1304, time 272.28ms, mfu 1.43%
iter 2100: loss 1.1361, time 276.60ms, mfu 1.43%
iter 2110: loss 1.1285, time 274.26ms, mfu 1.42%
iter 2120: loss 1.1305, time 275.31ms, mfu 1.41%
iter 2130: loss 1.1414, time 280.70ms, mfu 1.40%
iter 2140: loss 1.1360, time 281.52ms, mfu 1.40%
iter 2150: loss 1.1188, time 283.16ms, mfu 1.39%
iter 2160: loss 1.1416, time 289.22ms, mfu 1.38%
iter 2170: loss 1.1340, time 287.66ms, mfu 1.37%
iter 2180: loss 1.1109, time 292.75ms, mfu 1.36%
iter 2190: loss 1.1070, time 293.53ms, mfu 1.35%
iter 2200: loss 1.1267, time 292.56ms, mfu 1.34%
iter 2210: loss 1.1060, time 333.51ms, mfu 1.32%
iter 2220: loss 1.1255, time 291.70ms, mfu 1.32%
iter 2230: loss 1.1165, time 293.01ms, mfu 1.31%
iter 2240: loss 1.1302, time 290.37ms, mfu 1.31%
step 2250: train loss 1.0086, val loss 1.4871
iter 2250: loss 1.1057, time 25922.12ms, mfu 1.18%
iter 2260: loss 1.1021, time 230.25ms, mfu 1.22%
iter 2270: loss 1.1295, time 232.35ms, mfu 1.26%
iter 2280: loss 1.0974, time 234.21ms, mfu 1.29%
iter 2290: loss 1.1377, time 234.74ms, mfu 1.32%
iter 2300: loss 1.1244, time 236.05ms, mfu 1.35%
iter 2310: loss 1.0974, time 236.66ms, mfu 1.37%
iter 2320: loss 1.0943, time 236.91ms, mfu 1.39%
iter 2330: loss 1.0954, time 235.80ms, mfu 1.41%
iter 2340: loss 1.1181, time 234.38ms, mfu 1.43%
iter 2350: loss 1.1017, time 234.06ms, mfu 1.44%
iter 2360: loss 1.1053, time 233.94ms, mfu 1.46%
iter 2370: loss 1.0898, time 233.47ms, mfu 1.47%
iter 2380: loss 1.0808, time 233.16ms, mfu 1.49%
iter 2390: loss 1.0797, time 231.45ms, mfu 1.50%
iter 2400: loss 1.0822, time 231.20ms, mfu 1.51%
iter 2410: loss 1.0731, time 229.80ms, mfu 1.52%
iter 2420: loss 1.0815, time 230.03ms, mfu 1.53%
iter 2430: loss 1.0541, time 229.37ms, mfu 1.54%
iter 2440: loss 1.0589, time 228.95ms, mfu 1.55%
iter 2450: loss 1.0673, time 228.37ms, mfu 1.56%
iter 2460: loss 1.0885, time 231.17ms, mfu 1.56%
iter 2470: loss 1.0896, time 230.69ms, mfu 1.57%
iter 2480: loss 1.0864, time 229.89ms, mfu 1.57%
iter 2490: loss 1.0615, time 229.19ms, mfu 1.58%
step 2500: train loss 0.9570, val loss 1.4965
iter 2500: loss 1.0838, time 28290.52ms, mfu 1.42%
iter 2510: loss 1.0661, time 251.19ms, mfu 1.43%
iter 2520: loss 1.0464, time 257.07ms, mfu 1.43%
iter 2530: loss 1.0527, time 258.97ms, mfu 1.43%
iter 2540: loss 1.0486, time 264.76ms, mfu 1.43%
iter 2550: loss 1.0742, time 268.19ms, mfu 1.42%
iter 2560: loss 1.0528, time 269.97ms, mfu 1.42%
iter 2570: loss 1.0727, time 271.34ms, mfu 1.42%
iter 2580: loss 1.0748, time 276.34ms, mfu 1.41%
iter 2590: loss 1.0639, time 282.22ms, mfu 1.40%
iter 2600: loss 1.0695, time 286.82ms, mfu 1.39%
iter 2610: loss 1.0523, time 285.86ms, mfu 1.38%
iter 2620: loss 1.0427, time 291.77ms, mfu 1.37%
iter 2630: loss 1.0213, time 291.53ms, mfu 1.36%
iter 2640: loss 1.0426, time 293.47ms, mfu 1.35%
iter 2650: loss 1.0562, time 302.76ms, mfu 1.34%
iter 2660: loss 1.0373, time 299.65ms, mfu 1.33%
iter 2670: loss 1.0112, time 299.25ms, mfu 1.32%
iter 2680: loss 1.0446, time 289.11ms, mfu 1.32%
iter 2690: loss 1.0557, time 309.40ms, mfu 1.31%
iter 2700: loss 1.0201, time 313.19ms, mfu 1.30%
iter 2710: loss 1.0411, time 305.64ms, mfu 1.29%
iter 2720: loss 1.0487, time 306.30ms, mfu 1.28%
iter 2730: loss 1.0615, time 303.56ms, mfu 1.28%
iter 2740: loss 1.0309, time 302.77ms, mfu 1.27%
step 2750: train loss 0.9100, val loss 1.5272
iter 2750: loss 1.0285, time 36286.23ms, mfu 1.14%
iter 2760: loss 1.0252, time 290.47ms, mfu 1.16%
iter 2770: loss 1.0260, time 292.03ms, mfu 1.17%
iter 2780: loss 1.0236, time 288.56ms, mfu 1.18%
iter 2790: loss 1.0353, time 291.93ms, mfu 1.19%
iter 2800: loss 1.0076, time 283.58ms, mfu 1.20%
iter 2810: loss 1.0355, time 293.42ms, mfu 1.21%
iter 2820: loss 1.0251, time 284.87ms, mfu 1.22%
iter 2830: loss 1.0307, time 285.43ms, mfu 1.23%
iter 2840: loss 0.9908, time 281.09ms, mfu 1.24%
iter 2850: loss 1.0232, time 283.09ms, mfu 1.25%
iter 2860: loss 1.0225, time 286.51ms, mfu 1.25%
iter 2870: loss 0.9979, time 279.13ms, mfu 1.26%
iter 2880: loss 1.0298, time 91293.88ms, mfu 1.13%
iter 2890: loss 1.0000, time 273.37ms, mfu 1.16%
iter 2900: loss 0.9898, time 257.65ms, mfu 1.19%
iter 2910: loss 1.0353, time 208.03ms, mfu 1.25%
iter 2920: loss 1.0061, time 244.89ms, mfu 1.27%
iter 2930: loss 0.9978, time 218.78ms, mfu 1.32%
iter 2940: loss 0.9932, time 18795.87ms, mfu 1.19%
iter 2950: loss 1.0178, time 243.13ms, mfu 1.22%
iter 2960: loss 1.0006, time 220.08ms, mfu 1.27%
iter 2970: loss 0.9829, time 219.14ms, mfu 1.31%
iter 2980: loss 0.9917, time 219.39ms, mfu 1.35%
iter 2990: loss 0.9834, time 219.23ms, mfu 1.39%
step 3000: train loss 0.8650, val loss 1.5254
iter 3000: loss 0.9834, time 26787.21ms, mfu 1.25%
iter 3010: loss 0.9889, time 233.11ms, mfu 1.28%
iter 3020: loss 1.0056, time 233.32ms, mfu 1.31%
iter 3030: loss 0.9959, time 233.19ms, mfu 1.34%
iter 3040: loss 1.0224, time 231.80ms, mfu 1.37%
iter 3050: loss 0.9771, time 232.04ms, mfu 1.39%
iter 3060: loss 0.9875, time 230.79ms, mfu 1.42%
iter 3070: loss 1.0085, time 229.68ms, mfu 1.44%
iter 3080: loss 0.9967, time 229.35ms, mfu 1.45%
iter 3090: loss 0.9819, time 229.35ms, mfu 1.47%
iter 3100: loss 0.9941, time 228.64ms, mfu 1.49%
iter 3110: loss 0.9743, time 228.55ms, mfu 1.50%
iter 3120: loss 0.9969, time 228.62ms, mfu 1.51%
iter 3130: loss 0.9793, time 226.97ms, mfu 1.53%
iter 3140: loss 0.9743, time 229.49ms, mfu 1.54%
iter 3150: loss 1.0012, time 229.36ms, mfu 1.55%
iter 3160: loss 1.0072, time 229.09ms, mfu 1.55%
iter 3170: loss 0.9645, time 228.45ms, mfu 1.56%
iter 3180: loss 0.9663, time 227.90ms, mfu 1.57%
iter 3190: loss 0.9941, time 227.88ms, mfu 1.58%
iter 3200: loss 0.9581, time 226.47ms, mfu 1.58%
iter 3210: loss 0.9573, time 226.26ms, mfu 1.59%
iter 3220: loss 0.9594, time 225.40ms, mfu 1.60%
iter 3230: loss 0.9475, time 227.25ms, mfu 1.60%
iter 3240: loss 0.9622, time 228.99ms, mfu 1.60%
step 3250: train loss 0.8193, val loss 1.5605
iter 3250: loss 0.9719, time 28623.22ms, mfu 1.44%
iter 3260: loss 0.9596, time 253.62ms, mfu 1.45%
iter 3270: loss 0.9712, time 263.02ms, mfu 1.44%
iter 3280: loss 0.9410, time 256.25ms, mfu 1.44%
iter 3290: loss 0.9460, time 261.96ms, mfu 1.44%
iter 3300: loss 0.9362, time 254.70ms, mfu 1.44%
iter 3310: loss 0.9504, time 216.22ms, mfu 1.47%
iter 3320: loss 0.9590, time 240.19ms, mfu 1.48%
iter 3330: loss 0.9543, time 250.22ms, mfu 1.48%
iter 3340: loss 0.9490, time 217.55ms, mfu 1.50%
iter 3350: loss 0.9509, time 247.37ms, mfu 1.50%
iter 3360: loss 0.9296, time 557.37ms, mfu 1.42%
iter 3370: loss 0.9496, time 218.23ms, mfu 1.45%
iter 3380: loss 0.9423, time 233.82ms, mfu 1.46%
iter 3390: loss 0.9537, time 278.92ms, mfu 1.45%
iter 3400: loss 0.9538, time 266.08ms, mfu 1.45%
iter 3410: loss 0.9359, time 215.90ms, mfu 1.47%
iter 3420: loss 0.9409, time 248.24ms, mfu 1.48%
iter 3430: loss 0.9467, time 260.85ms, mfu 1.47%
iter 3440: loss 0.9691, time 230.54ms, mfu 1.49%
iter 3450: loss 0.9559, time 235.94ms, mfu 1.50%
iter 3460: loss 0.9474, time 219.90ms, mfu 1.52%
iter 3470: loss 0.9468, time 235.19ms, mfu 1.52%
iter 3480: loss 0.9470, time 221.06ms, mfu 1.54%
iter 3490: loss 0.9138, time 207.69ms, mfu 1.56%
step 3500: train loss 0.7776, val loss 1.5801
iter 3500: loss 0.9017, time 346728.12ms, mfu 1.41%
iter 3510: loss 0.9111, time 220.01ms, mfu 1.44%
iter 3520: loss 0.9165, time 221.05ms, mfu 1.46%
iter 3530: loss 0.9474, time 220.55ms, mfu 1.48%
iter 3540: loss 0.9341, time 218.71ms, mfu 1.51%
iter 3550: loss 0.9226, time 242.07ms, mfu 1.51%
iter 3560: loss 0.9452, time 219.95ms, mfu 1.53%
iter 3570: loss 0.9324, time 225.86ms, mfu 1.54%
iter 3580: loss 0.9310, time 228.74ms, mfu 1.55%
iter 3590: loss 0.9173, time 230.98ms, mfu 1.56%
iter 3600: loss 0.9208, time 232.78ms, mfu 1.56%
iter 3610: loss 0.9054, time 232.88ms, mfu 1.56%
iter 3620: loss 0.9094, time 233.12ms, mfu 1.57%
iter 3630: loss 0.9230, time 232.98ms, mfu 1.57%
iter 3640: loss 0.9098, time 232.19ms, mfu 1.57%
iter 3650: loss 0.9106, time 232.40ms, mfu 1.58%
iter 3660: loss 0.9329, time 230.95ms, mfu 1.58%
iter 3670: loss 0.9310, time 230.36ms, mfu 1.58%
iter 3680: loss 0.9055, time 230.58ms, mfu 1.59%
iter 3690: loss 0.9322, time 230.26ms, mfu 1.59%
iter 3700: loss 0.8712, time 228.75ms, mfu 1.59%
iter 3710: loss 0.8790, time 228.66ms, mfu 1.60%
iter 3720: loss 0.8983, time 227.36ms, mfu 1.60%
iter 3730: loss 0.8991, time 226.64ms, mfu 1.61%
iter 3740: loss 0.9019, time 226.39ms, mfu 1.61%
step 3750: train loss 0.7386, val loss 1.6014
iter 3750: loss 0.9019, time 26893.00ms, mfu 1.45%
iter 3760: loss 0.9302, time 224.55ms, mfu 1.47%
iter 3770: loss 0.9291, time 222.68ms, mfu 1.49%
iter 3780: loss 0.9133, time 222.94ms, mfu 1.51%
iter 3790: loss 0.8945, time 220.55ms, mfu 1.53%
iter 3800: loss 0.9080, time 222.20ms, mfu 1.54%
iter 3810: loss 0.9115, time 221.63ms, mfu 1.56%
iter 3820: loss 0.8943, time 221.40ms, mfu 1.57%
iter 3830: loss 0.8969, time 221.23ms, mfu 1.58%
iter 3840: loss 0.8893, time 222.63ms, mfu 1.59%
iter 3850: loss 0.8859, time 221.56ms, mfu 1.60%
iter 3860: loss 0.8814, time 220.70ms, mfu 1.61%
iter 3870: loss 0.8873, time 222.85ms, mfu 1.61%
iter 3880: loss 0.8861, time 223.78ms, mfu 1.62%
iter 3890: loss 0.8952, time 221.04ms, mfu 1.63%
iter 3900: loss 0.8903, time 224.73ms, mfu 1.63%
iter 3910: loss 0.8856, time 225.99ms, mfu 1.63%
iter 3920: loss 0.8656, time 217.57ms, mfu 1.64%
iter 3930: loss 0.8955, time 216.05ms, mfu 1.65%
iter 3940: loss 0.8702, time 218.95ms, mfu 1.65%
iter 3950: loss 0.8742, time 218.12ms, mfu 1.66%
iter 3960: loss 0.9007, time 218.10ms, mfu 1.66%
iter 3970: loss 0.8936, time 215.10ms, mfu 1.67%
iter 3980: loss 0.8998, time 112654.24ms, mfu 1.50%
iter 3990: loss 0.8711, time 241.06ms, mfu 1.51%
step 4000: train loss 0.7049, val loss 1.6351
iter 4000: loss 0.8594, time 25746.76ms, mfu 1.36%
iter 4010: loss 0.8805, time 220.82ms, mfu 1.39%
iter 4020: loss 0.8821, time 225.68ms, mfu 1.42%
iter 4030: loss 0.8798, time 229.14ms, mfu 1.44%
iter 4040: loss 0.8718, time 231.03ms, mfu 1.46%
iter 4050: loss 0.8663, time 232.34ms, mfu 1.47%
iter 4060: loss 0.8591, time 233.45ms, mfu 1.48%
iter 4070: loss 0.8579, time 233.32ms, mfu 1.49%
iter 4080: loss 0.8709, time 233.22ms, mfu 1.50%
iter 4090: loss 0.8497, time 232.62ms, mfu 1.51%
iter 4100: loss 0.8939, time 231.87ms, mfu 1.52%
iter 4110: loss 0.8635, time 232.86ms, mfu 1.53%
iter 4120: loss 0.8786, time 231.32ms, mfu 1.54%
iter 4130: loss 0.8574, time 229.94ms, mfu 1.55%
iter 4140: loss 0.8666, time 230.07ms, mfu 1.55%
iter 4150: loss 0.8692, time 229.77ms, mfu 1.56%
iter 4160: loss 0.8529, time 228.90ms, mfu 1.57%
iter 4170: loss 0.8668, time 227.94ms, mfu 1.57%
iter 4180: loss 0.8690, time 228.35ms, mfu 1.58%
iter 4190: loss 0.8653, time 228.21ms, mfu 1.59%
iter 4200: loss 0.8490, time 227.97ms, mfu 1.59%
iter 4210: loss 0.8621, time 229.10ms, mfu 1.59%
iter 4220: loss 0.8599, time 228.83ms, mfu 1.60%
iter 4230: loss 0.8803, time 228.68ms, mfu 1.60%
iter 4240: loss 0.8644, time 227.70ms, mfu 1.60%
step 4250: train loss 0.6744, val loss 1.6547
iter 4250: loss 0.8579, time 26842.15ms, mfu 1.45%
iter 4260: loss 0.8601, time 231.72ms, mfu 1.46%
iter 4270: loss 0.8602, time 232.27ms, mfu 1.48%
iter 4280: loss 0.8488, time 233.84ms, mfu 1.49%
iter 4290: loss 0.8339, time 235.94ms, mfu 1.50%
iter 4300: loss 0.8239, time 231.47ms, mfu 1.51%
iter 4310: loss 0.8540, time 238.35ms, mfu 1.51%
iter 4320: loss 0.8372, time 241.57ms, mfu 1.52%
iter 4330: loss 0.8573, time 240.50ms, mfu 1.52%
iter 4340: loss 0.8251, time 243.77ms, mfu 1.52%
iter 4350: loss 0.8325, time 246.13ms, mfu 1.52%
iter 4360: loss 0.8626, time 248.46ms, mfu 1.52%
iter 4370: loss 0.8460, time 249.68ms, mfu 1.52%
iter 4380: loss 0.8371, time 254.25ms, mfu 1.51%
iter 4390: loss 0.8612, time 255.93ms, mfu 1.50%
iter 4400: loss 0.8455, time 264.83ms, mfu 1.50%
iter 4410: loss 0.8668, time 263.02ms, mfu 1.49%
iter 4420: loss 0.8628, time 261.91ms, mfu 1.48%
iter 4430: loss 0.8463, time 270.07ms, mfu 1.47%
iter 4440: loss 0.8401, time 272.13ms, mfu 1.46%
iter 4450: loss 0.8402, time 271.64ms, mfu 1.45%
iter 4460: loss 0.8311, time 276.04ms, mfu 1.44%
iter 4470: loss 0.8475, time 281.71ms, mfu 1.43%
iter 4480: loss 0.8304, time 283.68ms, mfu 1.42%
iter 4490: loss 0.8338, time 284.32ms, mfu 1.41%
step 4500: train loss 0.6482, val loss 1.6792
iter 4500: loss 0.8586, time 36083.69ms, mfu 1.27%
iter 4510: loss 0.8487, time 308.19ms, mfu 1.26%
iter 4520: loss 0.8258, time 311.36ms, mfu 1.26%
iter 4530: loss 0.8424, time 309.81ms, mfu 1.25%
iter 4540: loss 0.8452, time 304.50ms, mfu 1.25%
iter 4550: loss 0.8654, time 305.37ms, mfu 1.24%
iter 4560: loss 0.8348, time 302.07ms, mfu 1.24%
iter 4570: loss 0.8434, time 304.48ms, mfu 1.24%
iter 4580: loss 0.8470, time 308.08ms, mfu 1.24%
iter 4590: loss 0.8512, time 307.67ms, mfu 1.24%
iter 4600: loss 0.8199, time 300.45ms, mfu 1.24%
iter 4610: loss 0.8622, time 300.01ms, mfu 1.24%
iter 4620: loss 0.8210, time 302.38ms, mfu 1.24%
iter 4630: loss 0.8257, time 304.74ms, mfu 1.23%
iter 4640: loss 0.8390, time 296.69ms, mfu 1.24%
iter 4650: loss 0.8560, time 293.12ms, mfu 1.24%
iter 4660: loss 0.8405, time 300.70ms, mfu 1.24%
iter 4670: loss 0.8388, time 292.43ms, mfu 1.24%
iter 4680: loss 0.8457, time 290.80ms, mfu 1.25%
iter 4690: loss 0.8303, time 294.38ms, mfu 1.25%
iter 4700: loss 0.8205, time 286.69ms, mfu 1.25%
iter 4710: loss 0.7871, time 294.38ms, mfu 1.26%
iter 4720: loss 0.8260, time 286.25ms, mfu 1.26%
iter 4730: loss 0.8164, time 291.94ms, mfu 1.26%
iter 4740: loss 0.8265, time 285.71ms, mfu 1.27%
step 4750: train loss 0.6291, val loss 1.6938
iter 4750: loss 0.7923, time 34278.72ms, mfu 1.14%
iter 4760: loss 0.8172, time 285.56ms, mfu 1.16%
iter 4770: loss 0.7934, time 277.51ms, mfu 1.18%
iter 4780: loss 0.8106, time 281.10ms, mfu 1.19%
iter 4790: loss 0.8258, time 283.78ms, mfu 1.20%
iter 4800: loss 0.8142, time 278.93ms, mfu 1.22%
iter 4810: loss 0.8396, time 281.49ms, mfu 1.23%
iter 4820: loss 0.8157, time 283.19ms, mfu 1.24%
iter 4830: loss 0.8106, time 277.93ms, mfu 1.25%
iter 4840: loss 0.8253, time 282.10ms, mfu 1.25%
iter 4850: loss 0.8207, time 279.25ms, mfu 1.26%
iter 4860: loss 0.8148, time 277.68ms, mfu 1.27%
iter 4870: loss 0.8023, time 279.20ms, mfu 1.28%
iter 4880: loss 0.8288, time 278.05ms, mfu 1.28%
iter 4890: loss 0.8094, time 276.20ms, mfu 1.29%
iter 4900: loss 0.8038, time 275.84ms, mfu 1.30%
iter 4910: loss 0.8293, time 281.13ms, mfu 1.30%
iter 4920: loss 0.8117, time 274.68ms, mfu 1.30%
iter 4930: loss 0.8076, time 276.59ms, mfu 1.31%
iter 4940: loss 0.7992, time 280.57ms, mfu 1.31%
iter 4950: loss 0.8223, time 276.39ms, mfu 1.31%
iter 4960: loss 0.8129, time 275.30ms, mfu 1.32%
iter 4970: loss 0.7781, time 274.56ms, mfu 1.32%
iter 4980: loss 0.7938, time 279.08ms, mfu 1.32%
iter 4990: loss 0.8203, time 276.23ms, mfu 1.33%
step 5000: train loss 0.6166, val loss 1.7099
iter 5000: loss 0.8117, time 33010.34ms, mfu 1.19%
     3588.66 real        90.18 user        32.03 sys
```

### Training (MPS, with compilation)

```
/usr/bin/time uv run train.py config/train_shakespeare_char.py --device=mps --compile=True

...

step 0: train loss 4.2874, val loss 4.2823
iter 0: loss 4.2672, time 85292.53ms, mfu -100.00%
iter 10: loss 3.1471, time 304.79ms, mfu 1.22%
iter 20: loss 2.7730, time 305.33ms, mfu 1.22%
iter 30: loss 2.6538, time 306.39ms, mfu 1.22%
iter 40: loss 2.5960, time 306.01ms, mfu 1.22%
iter 50: loss 2.5479, time 305.41ms, mfu 1.22%
iter 60: loss 2.5225, time 306.27ms, mfu 1.22%
iter 70: loss 2.5075, time 305.45ms, mfu 1.22%
iter 80: loss 2.5035, time 305.19ms, mfu 1.22%
iter 90: loss 2.4759, time 306.41ms, mfu 1.22%
iter 100: loss 2.4703, time 306.06ms, mfu 1.22%
iter 110: loss 2.4623, time 305.83ms, mfu 1.22%
iter 120: loss 2.4334, time 306.67ms, mfu 1.22%
iter 130: loss 2.4249, time 307.79ms, mfu 1.22%
iter 140: loss 2.4050, time 305.06ms, mfu 1.22%
iter 150: loss 2.4091, time 304.72ms, mfu 1.22%
iter 160: loss 2.3787, time 304.77ms, mfu 1.22%
iter 170: loss 2.3538, time 312.98ms, mfu 1.22%
iter 180: loss 2.3063, time 308.76ms, mfu 1.22%
iter 190: loss 2.2496, time 309.53ms, mfu 1.21%
iter 200: loss 2.2144, time 309.46ms, mfu 1.21%
iter 210: loss 2.1572, time 308.49ms, mfu 1.21%
iter 220: loss 2.1547, time 308.88ms, mfu 1.21%
iter 230: loss 2.0977, time 309.60ms, mfu 1.21%
iter 240: loss 2.1005, time 308.70ms, mfu 1.21%
step 250: train loss 1.9921, val loss 2.0831
saving checkpoint to out-shakespeare-char
iter 250: loss 2.0691, time 82281.59ms, mfu 1.09%
iter 260: loss 1.9987, time 305.40ms, mfu 1.10%
iter 270: loss 2.0043, time 305.57ms, mfu 1.11%
iter 280: loss 2.0042, time 305.39ms, mfu 1.13%
iter 290: loss 1.9525, time 306.25ms, mfu 1.13%
iter 300: loss 1.9256, time 306.46ms, mfu 1.14%
iter 310: loss 1.8933, time 307.09ms, mfu 1.15%
iter 320: loss 1.8855, time 306.97ms, mfu 1.16%
iter 330: loss 1.8544, time 305.30ms, mfu 1.16%
iter 340: loss 1.8091, time 306.03ms, mfu 1.17%
iter 350: loss 1.8614, time 306.17ms, mfu 1.17%
iter 360: loss 1.8010, time 306.52ms, mfu 1.18%
iter 370: loss 1.7670, time 305.79ms, mfu 1.18%
iter 380: loss 1.7564, time 306.72ms, mfu 1.18%
iter 390: loss 1.7554, time 306.00ms, mfu 1.19%
iter 400: loss 1.7919, time 306.66ms, mfu 1.19%
iter 410: loss 1.7239, time 306.07ms, mfu 1.19%
iter 420: loss 1.7457, time 305.91ms, mfu 1.20%
iter 430: loss 1.7143, time 305.90ms, mfu 1.20%
iter 440: loss 1.6851, time 305.03ms, mfu 1.20%
iter 450: loss 1.6803, time 307.06ms, mfu 1.20%
iter 460: loss 1.6169, time 305.51ms, mfu 1.20%
iter 470: loss 1.6870, time 305.60ms, mfu 1.21%
iter 480: loss 1.6545, time 305.99ms, mfu 1.21%
iter 490: loss 1.6232, time 306.53ms, mfu 1.21%
step 500: train loss 1.5550, val loss 1.7609
saving checkpoint to out-shakespeare-char
iter 500: loss 1.6238, time 81166.02ms, mfu 1.09%
iter 510: loss 1.6324, time 311.30ms, mfu 1.10%
iter 520: loss 1.6267, time 315.98ms, mfu 1.11%
iter 530: loss 1.5837, time 314.15ms, mfu 1.11%
iter 540: loss 1.6386, time 318.13ms, mfu 1.12%
iter 550: loss 1.5973, time 319.12ms, mfu 1.12%
iter 560: loss 1.5875, time 319.58ms, mfu 1.13%
iter 570: loss 1.5982, time 319.75ms, mfu 1.13%
iter 580: loss 1.5603, time 314.70ms, mfu 1.14%
iter 590: loss 1.5276, time 322.41ms, mfu 1.14%
iter 600: loss 1.5404, time 307.71ms, mfu 1.15%
iter 610: loss 1.5703, time 303.33ms, mfu 1.15%
iter 620: loss 1.5542, time 335.55ms, mfu 1.15%
iter 630: loss 1.5390, time 305.82ms, mfu 1.16%
iter 640: loss 1.4885, time 304.86ms, mfu 1.16%
iter 650: loss 1.5251, time 305.32ms, mfu 1.17%
iter 660: loss 1.5255, time 307.61ms, mfu 1.17%
iter 670: loss 1.4666, time 308.68ms, mfu 1.18%
iter 680: loss 1.5323, time 309.28ms, mfu 1.18%
iter 690: loss 1.4830, time 311.48ms, mfu 1.18%
iter 700: loss 1.5098, time 310.15ms, mfu 1.18%
iter 710: loss 1.4752, time 310.11ms, mfu 1.19%
iter 720: loss 1.4608, time 311.96ms, mfu 1.19%
iter 730: loss 1.4390, time 310.87ms, mfu 1.19%
iter 740: loss 1.4380, time 314.46ms, mfu 1.19%
step 750: train loss 1.3788, val loss 1.6023
saving checkpoint to out-shakespeare-char
iter 750: loss 1.4410, time 790276.03ms, mfu 1.07%
iter 760: loss 1.4564, time 305.20ms, mfu 1.08%
iter 770: loss 1.4394, time 305.04ms, mfu 1.10%
iter 780: loss 1.4370, time 314.04ms, mfu 1.11%
iter 790: loss 1.4356, time 306.15ms, mfu 1.12%
iter 800: loss 1.4432, time 315.89ms, mfu 1.12%
iter 810: loss 1.4247, time 310.05ms, mfu 1.13%
iter 820: loss 1.4185, time 310.33ms, mfu 1.14%
iter 830: loss 1.4131, time 312.18ms, mfu 1.14%
iter 840: loss 1.4194, time 316.59ms, mfu 1.15%
iter 850: loss 1.4017, time 322.66ms, mfu 1.15%
iter 860: loss 1.4033, time 326.19ms, mfu 1.15%
iter 870: loss 1.4138, time 328.35ms, mfu 1.15%
iter 880: loss 1.3882, time 327.24ms, mfu 1.15%
iter 890: loss 1.3976, time 323.56ms, mfu 1.15%
iter 900: loss 1.3787, time 320.25ms, mfu 1.15%
iter 910: loss 1.3316, time 317.81ms, mfu 1.15%
iter 920: loss 1.3770, time 316.40ms, mfu 1.15%
iter 930: loss 1.3757, time 314.45ms, mfu 1.16%
iter 940: loss 1.3574, time 312.53ms, mfu 1.16%
iter 950: loss 1.3662, time 311.55ms, mfu 1.16%
iter 960: loss 1.3748, time 310.41ms, mfu 1.17%
iter 970: loss 1.3666, time 309.98ms, mfu 1.17%
iter 980: loss 1.3664, time 308.72ms, mfu 1.17%
iter 990: loss 1.3488, time 308.84ms, mfu 1.18%
step 1000: train loss 1.2817, val loss 1.5324
saving checkpoint to out-shakespeare-char
iter 1000: loss 1.3394, time 1967401.88ms, mfu 1.06%
iter 1010: loss 1.3490, time 305.81ms, mfu 1.08%
iter 1020: loss 1.3176, time 306.09ms, mfu 1.09%
iter 1030: loss 1.3471, time 305.48ms, mfu 1.10%
iter 1040: loss 1.3675, time 308.99ms, mfu 1.11%
iter 1050: loss 1.3005, time 313.82ms, mfu 1.12%
iter 1060: loss 1.3549, time 317.82ms, mfu 1.13%
iter 1070: loss 1.3440, time 321.09ms, mfu 1.13%
iter 1080: loss 1.3454, time 322.19ms, mfu 1.13%
iter 1090: loss 1.3653, time 320.80ms, mfu 1.13%
iter 1100: loss 1.3270, time 320.88ms, mfu 1.14%
iter 1110: loss 1.3067, time 318.46ms, mfu 1.14%
iter 1120: loss 1.3043, time 322.16ms, mfu 1.14%
iter 1130: loss 1.3026, time 320.23ms, mfu 1.14%
iter 1140: loss 1.3024, time 317.59ms, mfu 1.15%
iter 1150: loss 1.3150, time 317.40ms, mfu 1.15%
iter 1160: loss 1.3322, time 315.93ms, mfu 1.15%
iter 1170: loss 1.3065, time 314.41ms, mfu 1.16%
iter 1180: loss 1.3215, time 313.90ms, mfu 1.16%
iter 1190: loss 1.2742, time 314.96ms, mfu 1.16%
iter 1200: loss 1.3023, time 312.95ms, mfu 1.16%
iter 1210: loss 1.2696, time 312.43ms, mfu 1.17%
iter 1220: loss 1.3074, time 305.66ms, mfu 1.17%
iter 1230: loss 1.3039, time 307.37ms, mfu 1.18%
iter 1240: loss 1.3079, time 307.08ms, mfu 1.18%
step 1250: train loss 1.2099, val loss 1.5017
saving checkpoint to out-shakespeare-char
iter 1250: loss 1.2784, time 2352307.03ms, mfu 1.06%
iter 1260: loss 1.2894, time 304.23ms, mfu 1.08%
iter 1270: loss 1.2695, time 304.65ms, mfu 1.09%
iter 1280: loss 1.2684, time 305.44ms, mfu 1.11%
iter 1290: loss 1.2879, time 305.68ms, mfu 1.12%
iter 1300: loss 1.3091, time 305.17ms, mfu 1.13%
iter 1310: loss 1.2443, time 305.77ms, mfu 1.14%
iter 1320: loss 1.3017, time 306.03ms, mfu 1.14%
iter 1330: loss 1.2716, time 307.36ms, mfu 1.15%
iter 1340: loss 1.3030, time 312.13ms, mfu 1.16%
iter 1350: loss 1.2650, time 317.41ms, mfu 1.16%
iter 1360: loss 1.2805, time 319.38ms, mfu 1.16%
iter 1370: loss 1.2541, time 320.24ms, mfu 1.16%
iter 1380: loss 1.2674, time 320.72ms, mfu 1.16%
iter 1390: loss 1.2551, time 318.70ms, mfu 1.16%
iter 1400: loss 1.2594, time 317.52ms, mfu 1.16%
iter 1410: loss 1.2517, time 315.03ms, mfu 1.16%
iter 1420: loss 1.2712, time 313.83ms, mfu 1.17%
iter 1430: loss 1.2447, time 312.43ms, mfu 1.17%
iter 1440: loss 1.2660, time 312.35ms, mfu 1.17%
iter 1450: loss 1.2296, time 310.35ms, mfu 1.17%
iter 1460: loss 1.2384, time 310.08ms, mfu 1.18%
iter 1470: loss 1.2234, time 308.78ms, mfu 1.18%
iter 1480: loss 1.2153, time 308.74ms, mfu 1.18%
iter 1490: loss 1.2377, time 308.47ms, mfu 1.19%
step 1500: train loss 1.1572, val loss 1.4892
saving checkpoint to out-shakespeare-char
iter 1500: loss 1.1939, time 1287511.02ms, mfu 1.07%
iter 1510: loss 1.2363, time 309.21ms, mfu 1.08%
iter 1520: loss 1.2294, time 311.06ms, mfu 1.09%
iter 1530: loss 1.2582, time 310.35ms, mfu 1.10%
iter 1540: loss 1.2030, time 310.30ms, mfu 1.11%
iter 1550: loss 1.2295, time 312.37ms, mfu 1.12%
iter 1560: loss 1.2098, time 316.32ms, mfu 1.13%
iter 1570: loss 1.2360, time 322.02ms, mfu 1.13%
iter 1580: loss 1.2052, time 321.67ms, mfu 1.13%
iter 1590: loss 1.1843, time 323.58ms, mfu 1.13%
iter 1600: loss 1.1978, time 322.84ms, mfu 1.14%
iter 1610: loss 1.2311, time 322.36ms, mfu 1.14%
iter 1620: loss 1.1915, time 320.49ms, mfu 1.14%
iter 1630: loss 1.2083, time 318.53ms, mfu 1.14%
iter 1640: loss 1.2016, time 317.42ms, mfu 1.15%
iter 1650: loss 1.1782, time 316.66ms, mfu 1.15%
iter 1660: loss 1.2174, time 313.64ms, mfu 1.15%
iter 1670: loss 1.2032, time 312.72ms, mfu 1.16%
iter 1680: loss 1.2126, time 312.16ms, mfu 1.16%
iter 1690: loss 1.1991, time 310.47ms, mfu 1.16%
iter 1700: loss 1.1789, time 310.59ms, mfu 1.17%
iter 1710: loss 1.1754, time 309.09ms, mfu 1.17%
iter 1720: loss 1.1863, time 309.51ms, mfu 1.18%
iter 1730: loss 1.2041, time 309.38ms, mfu 1.18%
iter 1740: loss 1.1685, time 307.62ms, mfu 1.18%
step 1750: train loss 1.1039, val loss 1.4745
saving checkpoint to out-shakespeare-char
iter 1750: loss 1.1850, time 1374666.86ms, mfu 1.06%
iter 1760: loss 1.1890, time 325.56ms, mfu 1.07%
iter 1770: loss 1.1984, time 320.49ms, mfu 1.08%
iter 1780: loss 1.1889, time 319.80ms, mfu 1.09%
iter 1790: loss 1.1870, time 317.88ms, mfu 1.10%
iter 1800: loss 1.1808, time 316.77ms, mfu 1.11%
iter 1810: loss 1.1624, time 315.91ms, mfu 1.11%
iter 1820: loss 1.1705, time 314.45ms, mfu 1.12%
iter 1830: loss 1.1689, time 313.60ms, mfu 1.13%
iter 1840: loss 1.1607, time 312.95ms, mfu 1.13%
iter 1850: loss 1.1580, time 311.63ms, mfu 1.14%
iter 1860: loss 1.1660, time 313.34ms, mfu 1.14%
iter 1870: loss 1.1407, time 312.35ms, mfu 1.15%
iter 1880: loss 1.1791, time 306.95ms, mfu 1.16%
iter 1890: loss 1.1707, time 303.50ms, mfu 1.16%
iter 1900: loss 1.1315, time 303.94ms, mfu 1.17%
iter 1910: loss 1.1640, time 304.47ms, mfu 1.17%
iter 1920: loss 1.1775, time 304.05ms, mfu 1.18%
iter 1930: loss 1.1398, time 312.81ms, mfu 1.18%
iter 1940: loss 1.1291, time 309.29ms, mfu 1.18%
iter 1950: loss 1.1289, time 305.26ms, mfu 1.19%
iter 1960: loss 1.1535, time 306.58ms, mfu 1.19%
iter 1970: loss 1.1524, time 305.43ms, mfu 1.19%
iter 1980: loss 1.1513, time 306.32ms, mfu 1.20%
iter 1990: loss 1.1471, time 306.24ms, mfu 1.20%
step 2000: train loss 1.0555, val loss 1.4805
iter 2000: loss 1.1290, time 1142033.57ms, mfu 1.08%
iter 2010: loss 1.1247, time 303.90ms, mfu 1.09%
iter 2020: loss 1.1269, time 304.64ms, mfu 1.11%
iter 2030: loss 1.1600, time 303.66ms, mfu 1.12%
iter 2040: loss 1.1422, time 303.98ms, mfu 1.13%
iter 2050: loss 1.1155, time 307.11ms, mfu 1.14%
iter 2060: loss 1.0980, time 304.84ms, mfu 1.15%
iter 2070: loss 1.1256, time 308.63ms, mfu 1.15%
iter 2080: loss 1.1211, time 305.78ms, mfu 1.16%
iter 2090: loss 1.1303, time 313.68ms, mfu 1.16%
iter 2100: loss 1.1388, time 310.00ms, mfu 1.17%
iter 2110: loss 1.1277, time 305.28ms, mfu 1.17%
iter 2120: loss 1.1243, time 324.34ms, mfu 1.17%
iter 2130: loss 1.1409, time 313.25ms, mfu 1.17%
iter 2140: loss 1.1375, time 309.95ms, mfu 1.17%
iter 2150: loss 1.1226, time 316.03ms, mfu 1.17%
iter 2160: loss 1.1432, time 315.96ms, mfu 1.17%
iter 2170: loss 1.1301, time 321.66ms, mfu 1.17%
iter 2180: loss 1.1183, time 326.30ms, mfu 1.17%
iter 2190: loss 1.1111, time 328.64ms, mfu 1.17%
iter 2200: loss 1.1216, time 329.11ms, mfu 1.16%
iter 2210: loss 1.1072, time 327.78ms, mfu 1.16%
iter 2220: loss 1.1180, time 320.33ms, mfu 1.16%
iter 2230: loss 1.1189, time 318.63ms, mfu 1.16%
iter 2240: loss 1.1289, time 317.17ms, mfu 1.16%
step 2250: train loss 1.0064, val loss 1.4947
iter 2250: loss 1.1079, time 1284804.04ms, mfu 1.05%
iter 2260: loss 1.0984, time 315.03ms, mfu 1.06%
iter 2270: loss 1.1203, time 304.06ms, mfu 1.08%
iter 2280: loss 1.0922, time 303.49ms, mfu 1.09%
iter 2290: loss 1.1402, time 303.56ms, mfu 1.11%
iter 2300: loss 1.1277, time 302.97ms, mfu 1.12%
iter 2310: loss 1.0846, time 903130.45ms, mfu 1.01%
iter 2320: loss 1.0938, time 302.48ms, mfu 1.03%
iter 2330: loss 1.0946, time 303.52ms, mfu 1.05%
iter 2340: loss 1.1194, time 302.47ms, mfu 1.07%
iter 2350: loss 1.1073, time 302.85ms, mfu 1.08%
iter 2360: loss 1.1026, time 303.07ms, mfu 1.10%
iter 2370: loss 1.0844, time 304.88ms, mfu 1.11%
iter 2380: loss 1.0838, time 303.70ms, mfu 1.12%
iter 2390: loss 1.0772, time 302.86ms, mfu 1.13%
iter 2400: loss 1.0815, time 302.84ms, mfu 1.14%
iter 2410: loss 1.0690, time 314.84ms, mfu 1.15%
iter 2420: loss 1.0769, time 303.44ms, mfu 1.15%
iter 2430: loss 1.0501, time 303.74ms, mfu 1.16%
iter 2440: loss 1.0575, time 303.62ms, mfu 1.17%
iter 2450: loss 1.0718, time 314.76ms, mfu 1.17%
iter 2460: loss 1.0880, time 304.03ms, mfu 1.18%
iter 2470: loss 1.0918, time 304.31ms, mfu 1.18%
iter 2480: loss 1.0820, time 303.85ms, mfu 1.19%
iter 2490: loss 1.0541, time 303.98ms, mfu 1.19%
step 2500: train loss 0.9572, val loss 1.4988
iter 2500: loss 1.0765, time 579899.18ms, mfu 1.07%
iter 2510: loss 1.0586, time 305.85ms, mfu 1.09%
iter 2520: loss 1.0419, time 306.29ms, mfu 1.10%
iter 2530: loss 1.0503, time 305.84ms, mfu 1.11%
iter 2540: loss 1.0522, time 304.31ms, mfu 1.12%
iter 2550: loss 1.0694, time 306.67ms, mfu 1.13%
iter 2560: loss 1.0508, time 305.66ms, mfu 1.14%
iter 2570: loss 1.0805, time 309.35ms, mfu 1.15%
iter 2580: loss 1.0726, time 305.97ms, mfu 1.15%
iter 2590: loss 1.0667, time 304.95ms, mfu 1.16%
iter 2600: loss 1.0650, time 305.62ms, mfu 1.17%
iter 2610: loss 1.0479, time 305.73ms, mfu 1.17%
iter 2620: loss 1.0462, time 305.01ms, mfu 1.18%
iter 2630: loss 1.0196, time 304.73ms, mfu 1.18%
iter 2640: loss 1.0428, time 304.78ms, mfu 1.19%
iter 2650: loss 1.0675, time 304.98ms, mfu 1.19%
iter 2660: loss 1.0381, time 305.02ms, mfu 1.19%
iter 2670: loss 1.0186, time 298.47ms, mfu 1.20%
iter 2680: loss 1.0450, time 306.57ms, mfu 1.20%
iter 2690: loss 1.0524, time 308.17ms, mfu 1.20%
iter 2700: loss 1.0279, time 305.35ms, mfu 1.20%
iter 2710: loss 1.0434, time 305.22ms, mfu 1.20%
iter 2720: loss 1.0378, time 305.56ms, mfu 1.21%
iter 2730: loss 1.0546, time 305.98ms, mfu 1.21%
iter 2740: loss 1.0212, time 304.96ms, mfu 1.21%
step 2750: train loss 0.9106, val loss 1.5201
iter 2750: loss 1.0342, time 82542.67ms, mfu 1.09%
iter 2760: loss 1.0253, time 305.13ms, mfu 1.10%
iter 2770: loss 1.0165, time 305.02ms, mfu 1.11%
iter 2780: loss 1.0238, time 305.80ms, mfu 1.12%
iter 2790: loss 1.0294, time 304.89ms, mfu 1.13%
iter 2800: loss 1.0122, time 306.83ms, mfu 1.14%
iter 2810: loss 1.0331, time 304.83ms, mfu 1.15%
iter 2820: loss 1.0314, time 305.80ms, mfu 1.16%
iter 2830: loss 1.0272, time 306.35ms, mfu 1.16%
iter 2840: loss 0.9934, time 306.00ms, mfu 1.17%
iter 2850: loss 1.0297, time 309.59ms, mfu 1.17%
iter 2860: loss 1.0225, time 306.82ms, mfu 1.18%
iter 2870: loss 1.0056, time 319.46ms, mfu 1.18%
iter 2880: loss 1.0332, time 332.50ms, mfu 1.17%
iter 2890: loss 1.0078, time 336.30ms, mfu 1.16%
iter 2900: loss 0.9893, time 338.84ms, mfu 1.16%
iter 2910: loss 1.0389, time 338.67ms, mfu 1.15%
iter 2920: loss 1.0082, time 337.76ms, mfu 1.15%
iter 2930: loss 0.9972, time 336.79ms, mfu 1.14%
iter 2940: loss 0.9955, time 334.25ms, mfu 1.14%
iter 2950: loss 1.0257, time 355.77ms, mfu 1.13%
iter 2960: loss 0.9948, time 347.00ms, mfu 1.12%
iter 2970: loss 0.9899, time 346.93ms, mfu 1.12%
iter 2980: loss 0.9939, time 320.92ms, mfu 1.12%
iter 2990: loss 0.9777, time 343.48ms, mfu 1.12%
step 3000: train loss 0.8651, val loss 1.5340
iter 3000: loss 0.9831, time 89141.44ms, mfu 1.01%
iter 3010: loss 0.9871, time 343.67ms, mfu 1.02%
iter 3020: loss 1.0052, time 349.15ms, mfu 1.02%
iter 3030: loss 0.9959, time 336.41ms, mfu 1.03%
iter 3040: loss 1.0243, time 345.76ms, mfu 1.03%
iter 3050: loss 0.9737, time 341.28ms, mfu 1.04%
iter 3060: loss 0.9916, time 21794.96ms, mfu 0.94%
iter 3070: loss 1.0157, time 304.38ms, mfu 0.97%
iter 3080: loss 0.9965, time 310.75ms, mfu 0.99%
iter 3090: loss 0.9829, time 304.05ms, mfu 1.01%
iter 3100: loss 0.9917, time 304.34ms, mfu 1.03%
iter 3110: loss 0.9663, time 291.42ms, mfu 1.06%
iter 3120: loss 0.9907, time 304.83ms, mfu 1.08%
iter 3130: loss 0.9796, time 303.78ms, mfu 1.09%
iter 3140: loss 0.9726, time 303.40ms, mfu 1.10%
iter 3150: loss 0.9957, time 304.42ms, mfu 1.12%
iter 3160: loss 1.0064, time 303.06ms, mfu 1.13%
iter 3170: loss 0.9583, time 304.12ms, mfu 1.14%
iter 3180: loss 0.9768, time 13484.41ms, mfu 1.03%
iter 3190: loss 0.9876, time 303.82ms, mfu 1.05%
iter 3200: loss 0.9642, time 303.23ms, mfu 1.06%
iter 3210: loss 0.9629, time 303.74ms, mfu 1.08%
iter 3220: loss 0.9538, time 303.71ms, mfu 1.10%
iter 3230: loss 0.9501, time 304.09ms, mfu 1.11%
iter 3240: loss 0.9566, time 303.04ms, mfu 1.12%
step 3250: train loss 0.8192, val loss 1.5734
iter 3250: loss 0.9634, time 245693.95ms, mfu 1.01%
iter 3260: loss 0.9673, time 305.24ms, mfu 1.03%
iter 3270: loss 0.9760, time 321.38ms, mfu 1.04%
iter 3280: loss 0.9485, time 314.20ms, mfu 1.06%
iter 3290: loss 0.9489, time 324.38ms, mfu 1.07%
iter 3300: loss 0.9375, time 322.85ms, mfu 1.08%
iter 3310: loss 0.9550, time 308.92ms, mfu 1.09%
iter 3320: loss 0.9592, time 318.37ms, mfu 1.10%
iter 3330: loss 0.9567, time 304.91ms, mfu 1.11%
iter 3340: loss 0.9502, time 27459.57ms, mfu 1.00%
iter 3350: loss 0.9612, time 309.31ms, mfu 1.02%
iter 3360: loss 0.9248, time 306.68ms, mfu 1.04%
iter 3370: loss 0.9522, time 307.29ms, mfu 1.06%
iter 3380: loss 0.9448, time 304.54ms, mfu 1.07%
iter 3390: loss 0.9599, time 305.89ms, mfu 1.09%
iter 3400: loss 0.9571, time 305.15ms, mfu 1.10%
iter 3410: loss 0.9459, time 416705.22ms, mfu 0.99%
iter 3420: loss 0.9382, time 307.00ms, mfu 1.01%
iter 3430: loss 0.9392, time 302.97ms, mfu 1.04%
iter 3440: loss 0.9779, time 304.12ms, mfu 1.05%
iter 3450: loss 0.9492, time 305.02ms, mfu 1.07%
iter 3460: loss 0.9450, time 297.68ms, mfu 1.09%
iter 3470: loss 0.9371, time 304.58ms, mfu 1.10%
iter 3480: loss 0.9418, time 304.20ms, mfu 1.11%
iter 3490: loss 0.9091, time 303.49ms, mfu 1.13%
step 3500: train loss 0.7801, val loss 1.5832
iter 3500: loss 0.9043, time 1485940.57ms, mfu 1.01%
iter 3510: loss 0.9091, time 305.40ms, mfu 1.03%
iter 3520: loss 0.9238, time 303.92ms, mfu 1.05%
iter 3530: loss 0.9447, time 304.32ms, mfu 1.07%
iter 3540: loss 0.9198, time 304.05ms, mfu 1.09%
iter 3550: loss 0.9206, time 304.56ms, mfu 1.10%
iter 3560: loss 0.9504, time 314.91ms, mfu 1.11%
iter 3570: loss 0.9290, time 304.82ms, mfu 1.12%
iter 3580: loss 0.9239, time 303.81ms, mfu 1.13%
iter 3590: loss 0.9301, time 303.98ms, mfu 1.14%
iter 3600: loss 0.9285, time 304.68ms, mfu 1.15%
iter 3610: loss 0.9213, time 303.98ms, mfu 1.16%
iter 3620: loss 0.9089, time 304.38ms, mfu 1.16%
iter 3630: loss 0.9229, time 303.20ms, mfu 1.17%
iter 3640: loss 0.9147, time 304.03ms, mfu 1.17%
iter 3650: loss 0.9168, time 303.67ms, mfu 1.18%
iter 3660: loss 0.9374, time 304.22ms, mfu 1.18%
iter 3670: loss 0.9316, time 302.96ms, mfu 1.19%
iter 3680: loss 0.9075, time 303.66ms, mfu 1.19%
iter 3690: loss 0.9309, time 303.11ms, mfu 1.20%
iter 3700: loss 0.8800, time 303.99ms, mfu 1.20%
iter 3710: loss 0.8810, time 315.96ms, mfu 1.20%
iter 3720: loss 0.9081, time 304.23ms, mfu 1.20%
iter 3730: loss 0.9073, time 304.38ms, mfu 1.20%
iter 3740: loss 0.9072, time 302.79ms, mfu 1.21%
step 3750: train loss 0.7403, val loss 1.6067
iter 3750: loss 0.8949, time 1355391.19ms, mfu 1.08%
iter 3760: loss 0.9343, time 318.72ms, mfu 1.09%
iter 3770: loss 0.9353, time 318.98ms, mfu 1.10%
iter 3780: loss 0.9218, time 317.34ms, mfu 1.11%
iter 3790: loss 0.8867, time 316.54ms, mfu 1.12%
iter 3800: loss 0.9165, time 315.81ms, mfu 1.12%
iter 3810: loss 0.9136, time 317.38ms, mfu 1.13%
iter 3820: loss 0.8923, time 315.37ms, mfu 1.13%
iter 3830: loss 0.8964, time 314.54ms, mfu 1.14%
iter 3840: loss 0.8948, time 310.40ms, mfu 1.14%
iter 3850: loss 0.8760, time 308.25ms, mfu 1.15%
iter 3860: loss 0.8689, time 306.98ms, mfu 1.16%
iter 3870: loss 0.9017, time 306.39ms, mfu 1.16%
iter 3880: loss 0.8861, time 307.23ms, mfu 1.17%
iter 3890: loss 0.8961, time 306.02ms, mfu 1.17%
iter 3900: loss 0.8872, time 306.03ms, mfu 1.18%
iter 3910: loss 0.8876, time 305.89ms, mfu 1.18%
iter 3920: loss 0.8665, time 307.40ms, mfu 1.18%
iter 3930: loss 0.8907, time 304.86ms, mfu 1.19%
iter 3940: loss 0.8795, time 305.64ms, mfu 1.19%
iter 3950: loss 0.8813, time 306.32ms, mfu 1.19%
iter 3960: loss 0.9014, time 305.33ms, mfu 1.20%
iter 3970: loss 0.8926, time 305.50ms, mfu 1.20%
iter 3980: loss 0.8919, time 305.06ms, mfu 1.20%
iter 3990: loss 0.8840, time 305.57ms, mfu 1.20%
step 4000: train loss 0.7074, val loss 1.6352
iter 4000: loss 0.8618, time 1441489.26ms, mfu 1.08%
iter 4010: loss 0.8857, time 303.44ms, mfu 1.10%
iter 4020: loss 0.8830, time 304.10ms, mfu 1.11%
iter 4030: loss 0.8770, time 304.31ms, mfu 1.12%
iter 4040: loss 0.8798, time 100180.80ms, mfu 1.01%
iter 4050: loss 0.8714, time 303.57ms, mfu 1.03%
iter 4060: loss 0.8500, time 304.30ms, mfu 1.05%
iter 4070: loss 0.8638, time 304.18ms, mfu 1.07%
iter 4080: loss 0.8817, time 303.91ms, mfu 1.08%
iter 4090: loss 0.8540, time 299.82ms, mfu 1.10%
iter 4100: loss 0.8923, time 304.01ms, mfu 1.11%
iter 4110: loss 0.8687, time 304.13ms, mfu 1.12%
iter 4120: loss 0.8802, time 303.61ms, mfu 1.13%
iter 4130: loss 0.8547, time 305.10ms, mfu 1.14%
iter 4140: loss 0.8828, time 303.33ms, mfu 1.15%
iter 4150: loss 0.8712, time 303.56ms, mfu 1.16%
iter 4160: loss 0.8573, time 303.94ms, mfu 1.17%
iter 4170: loss 0.8677, time 305.97ms, mfu 1.17%
iter 4180: loss 0.8650, time 302.77ms, mfu 1.18%
iter 4190: loss 0.8633, time 304.24ms, mfu 1.18%
iter 4200: loss 0.8520, time 304.42ms, mfu 1.19%
iter 4210: loss 0.8703, time 304.14ms, mfu 1.19%
iter 4220: loss 0.8597, time 325.29ms, mfu 1.19%
iter 4230: loss 0.8789, time 305.48ms, mfu 1.19%
iter 4240: loss 0.8671, time 307.07ms, mfu 1.19%
step 4250: train loss 0.6788, val loss 1.6561
iter 4250: loss 0.8717, time 939548.76ms, mfu 1.07%
iter 4260: loss 0.8630, time 303.65ms, mfu 1.09%
iter 4270: loss 0.8716, time 304.09ms, mfu 1.10%
iter 4280: loss 0.8638, time 304.94ms, mfu 1.11%
iter 4290: loss 0.8398, time 308.29ms, mfu 1.12%
iter 4300: loss 0.8264, time 305.50ms, mfu 1.13%
iter 4310: loss 0.8604, time 305.59ms, mfu 1.14%
iter 4320: loss 0.8369, time 304.70ms, mfu 1.15%
iter 4330: loss 0.8590, time 305.40ms, mfu 1.16%
iter 4340: loss 0.8310, time 304.16ms, mfu 1.16%
iter 4350: loss 0.8377, time 304.61ms, mfu 1.17%
iter 4360: loss 0.8638, time 305.02ms, mfu 1.17%
iter 4370: loss 0.8492, time 305.61ms, mfu 1.18%
iter 4380: loss 0.8420, time 306.41ms, mfu 1.18%
iter 4390: loss 0.8598, time 305.37ms, mfu 1.19%
iter 4400: loss 0.8462, time 309.15ms, mfu 1.19%
iter 4410: loss 0.8643, time 314.55ms, mfu 1.19%
iter 4420: loss 0.8643, time 318.49ms, mfu 1.19%
iter 4430: loss 0.8444, time 320.35ms, mfu 1.18%
iter 4440: loss 0.8466, time 320.85ms, mfu 1.18%
iter 4450: loss 0.8496, time 320.25ms, mfu 1.18%
iter 4460: loss 0.8275, time 319.05ms, mfu 1.18%
iter 4470: loss 0.8559, time 317.27ms, mfu 1.18%
iter 4480: loss 0.8284, time 316.30ms, mfu 1.18%
iter 4490: loss 0.8460, time 315.04ms, mfu 1.18%
step 4500: train loss 0.6550, val loss 1.6770
iter 4500: loss 0.8565, time 81428.05ms, mfu 1.06%
iter 4510: loss 0.8476, time 306.52ms, mfu 1.08%
iter 4520: loss 0.8353, time 306.20ms, mfu 1.09%
iter 4530: loss 0.8398, time 305.49ms, mfu 1.10%
iter 4540: loss 0.8535, time 306.21ms, mfu 1.11%
iter 4550: loss 0.8823, time 305.45ms, mfu 1.13%
iter 4560: loss 0.8383, time 304.68ms, mfu 1.14%
iter 4570: loss 0.8460, time 306.12ms, mfu 1.14%
iter 4580: loss 0.8512, time 305.64ms, mfu 1.15%
iter 4590: loss 0.8489, time 305.43ms, mfu 1.16%
iter 4600: loss 0.8365, time 304.52ms, mfu 1.16%
iter 4610: loss 0.8750, time 322.06ms, mfu 1.16%
iter 4620: loss 0.8390, time 1214.28ms, mfu 1.08%
iter 4630: loss 0.8283, time 738.76ms, mfu 1.02%
iter 4640: loss 0.8462, time 29216.77ms, mfu 0.92%
iter 4650: loss 0.8627, time 334.63ms, mfu 0.94%
iter 4660: loss 0.8556, time 913.93ms, mfu 0.89%
iter 4670: loss 0.8443, time 913.32ms, mfu 0.84%
iter 4680: loss 0.8548, time 915.72ms, mfu 0.80%
iter 4690: loss 0.8484, time 304.70ms, mfu 0.84%
iter 4700: loss 0.8274, time 304.79ms, mfu 0.88%
iter 4710: loss 0.7973, time 305.64ms, mfu 0.91%
iter 4720: loss 0.8320, time 306.18ms, mfu 0.94%
iter 4730: loss 0.8230, time 306.12ms, mfu 0.97%
iter 4740: loss 0.8346, time 303.44ms, mfu 0.99%
step 4750: train loss 0.6364, val loss 1.6925
iter 4750: loss 0.8009, time 621060.48ms, mfu 0.90%
iter 4760: loss 0.8227, time 322.99ms, mfu 0.92%
iter 4770: loss 0.8017, time 325.34ms, mfu 0.94%
iter 4780: loss 0.8184, time 325.64ms, mfu 0.96%
iter 4790: loss 0.8340, time 323.13ms, mfu 0.98%
iter 4800: loss 0.8256, time 319.82ms, mfu 1.00%
iter 4810: loss 0.8378, time 317.74ms, mfu 1.02%
iter 4820: loss 0.8169, time 315.52ms, mfu 1.03%
iter 4830: loss 0.8203, time 314.73ms, mfu 1.05%
iter 4840: loss 0.8373, time 313.41ms, mfu 1.06%
iter 4850: loss 0.8208, time 312.55ms, mfu 1.08%
iter 4860: loss 0.8208, time 310.79ms, mfu 1.09%
iter 4870: loss 0.8108, time 310.21ms, mfu 1.10%
iter 4880: loss 0.8351, time 310.26ms, mfu 1.11%
iter 4890: loss 0.8044, time 310.61ms, mfu 1.12%
iter 4900: loss 0.8092, time 309.37ms, mfu 1.13%
iter 4910: loss 0.8279, time 309.40ms, mfu 1.14%
iter 4920: loss 0.8184, time 307.53ms, mfu 1.14%
iter 4930: loss 0.8153, time 318.51ms, mfu 1.15%
iter 4940: loss 0.8012, time 307.91ms, mfu 1.15%
iter 4950: loss 0.8239, time 305.14ms, mfu 1.16%
iter 4960: loss 0.8355, time 913.04ms, mfu 1.08%
iter 4970: loss 0.7860, time 306.21ms, mfu 1.10%
iter 4980: loss 0.7914, time 314.64ms, mfu 1.11%
iter 4990: loss 0.8286, time 329.89ms, mfu 1.11%
step 5000: train loss 0.6221, val loss 1.7106
iter 5000: loss 0.8242, time 1255915.73ms, mfu 1.00%
    39039.74 real        72.21 user        21.28 sys
```

### Training (CPU, no compilation)

```
uv run train.py config/train_shakespeare_char.py --device=cpu --compile=False

...

step 0: train loss 4.2874, val loss 4.2823
iter 0: loss 4.2655, time 119984.47ms, mfu -100.00%
iter 10: loss 3.1338, time 1973.80ms, mfu 0.19%
iter 20: loss 2.7556, time 1984.34ms, mfu 0.19%
iter 30: loss 2.6094, time 1988.45ms, mfu 0.19%
iter 40: loss 2.5535, time 1983.75ms, mfu 0.19%
iter 50: loss 2.5237, time 2003.05ms, mfu 0.19%
```

### Observations

- You can use [asitop](https://github.com/tlkh/asitop) to confirm that GPU usage is at 100% when training on MPS, whether or not compilation is enabled.
- CPU+GPU+ANE is stable at 100% without compilation. With compilation, it generally hovers around 100% though drops slightly below that at times.
- I didn't run CPU training to completion, since it would take too long for a model of this size. It's only there for comparison purposes.
- If you look at iterations 10-50, the average time is about 221ms without compilation, 306ms with compilation and 1986ms on the CPU 
